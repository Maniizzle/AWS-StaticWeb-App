# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  save_hello_world_output:
    docker:
      - image: circleci/node:13.8.0
      
    steps:
      - run: mkdir -p myworkspace
      - run:
          name: "Save text"
          command: echo "saving my first text" > myworkspace/output.txt

  save_second_output:
    docker:
      - image: circleci/node:13.8.0
      
    steps:
      - run:
          name: "Save second text"
          command: echo "saving my second text" > ~/outputtwo.txt

      - persist_to_workspace:
          root: ~/
          paths:
            - outputtwo.txt
            
  print_output_file:
    docker:
      - image: circleci/node:13.8.0
      
    steps:
      - attach_workspace:
          at: myworkspace

      - run:
          name: "read text"
          command: cat myworkspace/output.txt
          
  print_second_output_file:
    docker:
      - image: circleci/node:13.8.0
      
    steps:
      - attach_workspace:
          at: ~/

      - run:
          name: "read text"
          command: cat ~/outputtwo.txt
  
        
  say-world:
    docker:
      - image : circleci/node:13.8.0
      
    steps:
      - run:
          name: "Say World"
          command: "echo world"
          
  echo_environment:
    docker: # use the Docker executor
      # CircleCI Node images available at: https://circleci.com/developer/images/image/cimg/node
      - image: circleci/node:13.8.0
      
    steps: # steps that comprise the `build` job
      - checkout # check out source code to working directory
      # Run a step to setup an environment variable
      # Redirect MY_ENV_VAR into $BASH_ENV
      - run:
          name: "Setup custom environment variables"
          command: echo $CIRCLE_BRANCH

# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  say-hello-workflow:
    jobs:
      - save_hello_world_output
      - print_output_file:
          requires: 
            - save_hello_world_output
      - save_second_output
      - print_second_output_file:
          requires:
            - save_second_output
      - say-world
      - echo_environment
